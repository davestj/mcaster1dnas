<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listener Authentication - Mcaster1DNAS Documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <style>
        :root{--mcaster-blue:#0ea5e9;--dnas-green:#22c55e;--text-primary:#1f2937;--text-secondary:#6b7280;--bg-white:#fff;--bg-light:#f8fafc;--bg-accent:#f1f5f9;--border-light:#e2e8f0;--shadow-medium:0 4px 6px -1px rgb(0 0 0 / 0.1);--gradient-brand:linear-gradient(135deg, var(--mcaster-blue), var(--dnas-green));--radius-md:0.5rem;--radius-lg:0.75rem;--font-sans:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;--font-mono:'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:var(--font-sans);line-height:1.6;color:var(--text-primary);background:var(--bg-light)}
        .breadcrumb{background:var(--bg-white);padding:1rem 0;border-bottom:1px solid var(--border-light)}
        .breadcrumb-container{max-width:1200px;margin:0 auto;padding:0 1rem;display:flex;align-items:center;gap:0.5rem;color:var(--text-secondary);font-size:0.875rem}
        .breadcrumb a{color:var(--mcaster-blue);text-decoration:none}
        .hero{background:var(--gradient-brand);color:white;padding:4rem 0 2rem 0}
        .hero-content{max-width:1200px;margin:0 auto;padding:0 1rem}
        .hero h1{font-size:3rem;font-weight:800;margin-bottom:0.5rem}
        .hero p{font-size:1.25rem;opacity:0.95}
        .container{max-width:1200px;margin:0 auto;padding:3rem 1rem}
        .content-card{background:var(--bg-white);border-radius:var(--radius-lg);padding:3rem;box-shadow:var(--shadow-medium);margin-bottom:2rem}
        .content-card h2{font-size:2rem;font-weight:700;color:var(--text-primary);margin:2.5rem 0 1rem 0;display:flex;align-items:center;gap:0.75rem}
        .content-card h2:first-child{margin-top:0}
        .content-card h2 i{color:var(--mcaster-blue)}
        .content-card h3{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:2rem 0 1rem 0}
        .content-card p{font-size:1.125rem;color:var(--text-secondary);line-height:1.8;margin-bottom:1.5rem}
        .content-card ul{margin:1rem 0 1.5rem 2rem}
        .content-card li{color:var(--text-secondary);line-height:1.8;margin-bottom:0.75rem}
        .code-block{background:#1e293b;color:#e2e8f0;padding:1.5rem;border-radius:var(--radius-md);overflow-x:auto;margin:1.5rem 0;font-family:var(--font-mono);font-size:0.875rem;line-height:1.6}
        .alert-box{padding:1.5rem;border-radius:var(--radius-md);margin:1.5rem 0;display:flex;align-items:flex-start;gap:1rem}
        .alert-info{background:#dbeafe;border:1px solid #3b82f6}
        .alert-warning{background:#fef3c7;border:1px solid #f59e0b}
        .alert-icon{font-size:1.25rem;flex-shrink:0}
        .alert-info .alert-icon{color:#1e40af}
        .alert-warning .alert-icon{color:#d97706}
        .alert-content{flex-grow:1}
        .alert-info .alert-content{color:#1e3a8a}
        .alert-warning .alert-content{color:#92400e}
        .auth-method{background:var(--bg-light);border-left:4px solid var(--mcaster-blue);padding:1.5rem;border-radius:var(--radius-lg);margin-bottom:1.5rem}
        .auth-method h4{font-size:1.25rem;font-weight:600;color:var(--text-primary);margin-bottom:1rem}
        @media (max-width:768px){.hero h1{font-size:2rem}.content-card{padding:2rem 1.5rem}}
    </style>
</head>
<body>
    <div class="breadcrumb">
        <div class="breadcrumb-container">
            <a href="index.html"><i class="fas fa-home"></i> Documentation</a>
            <i class="fas fa-chevron-right"></i>
            <span>Listener Authentication</span>
        </div>
    </div>

    <div class="hero">
        <div class="hero-content">
            <h1><i class="fas fa-lock"></i> Listener Authentication</h1>
            <p>Secure your streams with authentication</p>
        </div>
    </div>

    <div class="container">
        <div class="content-card">
            <h2><i class="fas fa-info-circle"></i> Overview</h2>
            <p>
                Listener authentication allows you to control who can access your streams. Whether you're running a
                subscription service, private broadcast, or pay-per-listen operation, Mcaster1DNAS v2.5.1-rc1 provides
                flexible authentication methods to secure your content.
            </p>

            <div class="alert-box alert-info">
                <i class="fas fa-shield-alt alert-icon"></i>
                <div class="alert-content">
                    <strong>Per-Mountpoint Control:</strong> Authentication is configured per mountpoint, allowing you to mix
                    public and secured streams on the same server. Some mountpoints can be open while others require authentication.
                </div>
            </div>

            <h2><i class="fas fa-layer-group"></i> Authentication Methods</h2>
            <p>Mcaster1DNAS v2.5.1-rc1 supports two primary authentication mechanisms:</p>

            <div class="auth-method">
                <h4><i class="fas fa-file-alt"></i> HTPASSWD Authentication</h4>
                <p>
                    File-based authentication using htpasswd format. Users and passwords are stored in a local file
                    that you manage through the web admin interface or command-line tools.
                </p>
                <ul>
                    <li><strong>Easy Management:</strong> Web interface for adding/removing users</li>
                    <li><strong>No Database Required:</strong> Simple file-based storage</li>
                    <li><strong>Duplicate Prevention:</strong> Optional enforcement of unique concurrent connections</li>
                </ul>
            </div>

            <div class="auth-method">
                <h4><i class="fas fa-globe"></i> URL Authentication</h4>
                <p>
                    External authentication via HTTP requests. Integrates with web applications, databases, payment processors,
                    or custom authentication systems (PHP, Python, Node.js, etc.).
                </p>
                <ul>
                    <li><strong>Flexible Integration:</strong> Connect to any web service</li>
                    <li><strong>Dynamic Validation:</strong> Real-time authentication against external systems</li>
                    <li><strong>Custom Logic:</strong> Implement complex authentication rules</li>
                </ul>
            </div>

            <h2><i class="fas fa-file-alt"></i> HTPASSWD Authentication (YAML)</h2>
            <p>
                Configure file-based authentication for simple username/password protection.
            </p>

            <div class="code-block"><pre># mcaster1.yaml
mount:
  - path: /premium
    stream_name: "Premium Stream"
    authentication:
      type: htpasswd
      filename: /etc/mcaster1/users.htpasswd
      allow_duplicate_users: false  # Prevent multiple connections per username</pre></div>

            <h3>Configuration Options</h3>
            <ul>
                <li><strong>type:</strong> Set to "htpasswd"</li>
                <li><strong>filename:</strong> Path to htpasswd file (relative to server basedir or absolute)</li>
                <li><strong>allow_duplicate_users:</strong> Allow/prevent multiple simultaneous connections with same username (default: false)</li>
            </ul>

            <h3>Managing Users via Web Interface</h3>
            <p>
                Access the authentication management interface at:
            </p>
            <div class="code-block"><pre>http://yourserver:8000/admin/stats.xsl</pre></div>

            <p>
                Look for the lock icon next to authenticated mountpoints. Click to manage users:
            </p>
            <ul>
                <li><strong>Add Users:</strong> Enter username and password, click "Add New User"</li>
                <li><strong>Delete Users:</strong> Click delete link next to each user</li>
                <li><strong>View Users:</strong> See all configured users for the mountpoint</li>
            </ul>

            <p>
                <strong>Note:</strong> The htpasswd file will be created automatically when you add the first user.
            </p>

            <h3>Managing Users via Command Line</h3>
            <div class="code-block"><pre># Create htpasswd file and add user
htpasswd -c /etc/mcaster1/users.htpasswd username

# Add additional users (without -c to avoid overwriting)
htpasswd /etc/mcaster1/users.htpasswd another_user

# Remove user (edit file manually or use htpasswd -D)
htpasswd -D /etc/mcaster1/users.htpasswd username</pre></div>

            <h2><i class="fas fa-globe"></i> URL Authentication (YAML)</h2>
            <p>
                Integrate with external web services for dynamic authentication.
            </p>

            <div class="code-block"><pre># mcaster1.yaml
mount:
  - path: /subscription
    stream_name: "Subscription Stream"
    authentication:
      type: url
      auth_url: https://example.com/auth/verify
      timeout: 5  # Timeout in seconds</pre></div>

            <h3>How URL Authentication Works</h3>
            <p>
                When a listener connects, Mcaster1DNAS sends an HTTP GET request to your auth_url with parameters:
            </p>

            <div class="code-block"><pre>https://example.com/auth/verify?mount=/subscription&user=username&pass=password&ip=192.168.1.100&agent=VLC%202.0</pre></div>

            <p>
                Your authentication script should return:
            </p>
            <ul>
                <li><strong>HTTP 200:</strong> Authentication successful, allow connection</li>
                <li><strong>HTTP 401/403:</strong> Authentication failed, deny connection</li>
                <li><strong>Any other code:</strong> Treated as authentication failure</li>
            </ul>

            <h3>Example PHP Authentication Script</h3>
            <div class="code-block"><pre>&lt;?php
// verify.php - Simple authentication example
$mount = $_GET['mount'] ?? '';
$user = $_GET['user'] ?? '';
$pass = $_GET['pass'] ?? '';
$ip = $_GET['ip'] ?? '';

// Check against database, payment processor, etc.
$db = new PDO('mysql:host=localhost;dbname=radio', 'user', 'pass');
$stmt = $db->prepare('SELECT * FROM subscribers WHERE username=? AND password_hash=?');
$stmt->execute([$user, password_hash($pass, PASSWORD_DEFAULT)]);

if ($stmt->rowCount() > 0) {
    // Log access
    $logStmt = $db->prepare('INSERT INTO access_log VALUES (?, ?, ?)');
    $logStmt->execute([$user, $ip, date('Y-m-d H:i:s')]);

    http_response_code(200);
    echo "Authenticated";
} else {
    http_response_code(403);
    echo "Access denied";
}
?&gt;</pre></div>

            <h2><i class="fas fa-users"></i> Use Cases</h2>

            <h3>Subscription Service</h3>
            <p>
                Use URL authentication to verify subscribers against a payment processor or membership database.
                Only active subscribers can listen.
            </p>

            <h3>Corporate Internal Streaming</h3>
            <p>
                Use HTPASSWD with employee credentials. Distribute usernames/passwords to authorized staff only.
            </p>

            <h3>Pay-Per-Listen</h3>
            <p>
                URL authentication with payment gateway integration. Verify payment before allowing stream access.
            </p>

            <h3>Geographic Restrictions</h3>
            <p>
                URL authentication can check IP geolocation and deny access from specific countries or regions.
            </p>

            <h3>Time-Limited Access</h3>
            <p>
                URL authentication with expiring tokens. Grant temporary access that expires after a set time.
            </p>

            <h2><i class="fas fa-chart-line"></i> Monitoring Authenticated Streams</h2>
            <p>
                Track who's listening to authenticated streams:
            </p>

            <div class="code-block"><pre>http://yourserver:8000/admin/listclients?mount=/premium</pre></div>

            <p>
                Shows usernames of authenticated listeners along with connection times and IP addresses.
            </p>

            <h2><i class="fas fa-shield-alt"></i> Security Best Practices</h2>
            <ul>
                <li><strong>Use HTTPS:</strong> Encrypt credentials in transit with SSL/TLS</li>
                <li><strong>Strong Passwords:</strong> Enforce password complexity requirements</li>
                <li><strong>Limit Duplicate Logins:</strong> Set <code>allow_duplicate_users: false</code> to prevent sharing</li>
                <li><strong>Log Access:</strong> Monitor who connects and from where</li>
                <li><strong>IP Whitelisting:</strong> Combine with firewall rules for additional security</li>
                <li><strong>Regular Audits:</strong> Review user accounts and remove inactive users</li>
                <li><strong>Secure Auth Scripts:</strong> Validate and sanitize all input in URL authentication handlers</li>
            </ul>

            <div class="alert-box alert-warning">
                <i class="fas fa-exclamation-triangle alert-icon"></i>
                <div class="alert-content">
                    <strong>Security Warning:</strong> Without HTTPS, credentials are sent in plaintext and can be intercepted.
                    Always use SSL/TLS for authenticated streams in production environments.
                </div>
            </div>

            <h2><i class="fas fa-wrench"></i> Troubleshooting Authentication</h2>

            <h3>Users Can't Connect</h3>
            <ul>
                <li>Verify htpasswd file path is correct and readable</li>
                <li>Check usernames and passwords are correct (case-sensitive)</li>
                <li>Review error.log for authentication failures</li>
                <li>Test URL authentication endpoint manually with curl</li>
            </ul>

            <h3>Duplicate Login Prevention Not Working</h3>
            <ul>
                <li>Ensure <code>allow_duplicate_users: false</code> is set</li>
                <li>Check that users aren't reconnecting with different sessions</li>
                <li>Review timeout settings that may disconnect idle users</li>
            </ul>

            <h3>URL Authentication Timing Out</h3>
            <ul>
                <li>Increase timeout value in configuration</li>
                <li>Optimize authentication script performance</li>
                <li>Check network connectivity to auth server</li>
                <li>Review auth server logs for errors</li>
            </ul>

            <div style="background:var(--bg-accent);border-left:4px solid var(--dnas-green);padding:1.5rem;border-radius:var(--radius-lg);margin-top:2rem">
                <p style="margin:0;color:var(--text-primary)">
                    <strong><i class="fas fa-lightbulb"></i> Next Steps:</strong>
                    Review the <a href="mcaster1dnas_config_file.html" style="color:var(--mcaster-blue);font-weight:600">Configuration Reference</a>
                    or explore <a href="mcaster1dnas_admin.html" style="color:var(--mcaster-blue);font-weight:600">Admin Interface</a> features.
                </p>
            </div>
        </div>
    </div>
</body>
</html>
