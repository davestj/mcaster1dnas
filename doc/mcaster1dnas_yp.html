<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YP Directory - Mcaster1DNAS Documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <style>
        :root{--mcaster-blue:#0ea5e9;--dnas-green:#22c55e;--text-primary:#1f2937;--text-secondary:#6b7280;--bg-white:#fff;--bg-light:#f8fafc;--bg-accent:#f1f5f9;--border-light:#e2e8f0;--shadow-medium:0 4px 6px -1px rgb(0 0 0 / 0.1);--gradient-brand:linear-gradient(135deg, var(--mcaster-blue), var(--dnas-green));--radius-md:0.5rem;--radius-lg:0.75rem;--font-sans:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;--font-mono:'SF Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:var(--font-sans);line-height:1.6;color:var(--text-primary);background:var(--bg-light)}
        .breadcrumb{background:var(--bg-white);padding:1rem 0;border-bottom:1px solid var(--border-light)}
        .breadcrumb-container{max-width:1200px;margin:0 auto;padding:0 1rem;display:flex;align-items:center;gap:0.5rem;color:var(--text-secondary);font-size:0.875rem}
        .breadcrumb a{color:var(--mcaster-blue);text-decoration:none}
        .hero{background:var(--gradient-brand);color:white;padding:4rem 0 2rem 0}
        .hero-content{max-width:1200px;margin:0 auto;padding:0 1rem}
        .hero h1{font-size:3rem;font-weight:800;margin-bottom:0.5rem}
        .hero p{font-size:1.25rem;opacity:0.95}
        .container{max-width:1200px;margin:0 auto;padding:3rem 1rem}
        .content-card{background:var(--bg-white);border-radius:var(--radius-lg);padding:3rem;box-shadow:var(--shadow-medium);margin-bottom:2rem}
        .content-card h2{font-size:2rem;font-weight:700;color:var(--text-primary);margin:2.5rem 0 1rem 0;display:flex;align-items:center;gap:0.75rem}
        .content-card h2:first-child{margin-top:0}
        .content-card h2 i{color:var(--mcaster-blue)}
        .content-card h3{font-size:1.5rem;font-weight:600;color:var(--text-primary);margin:2rem 0 1rem 0}
        .content-card p{font-size:1.125rem;color:var(--text-secondary);line-height:1.8;margin-bottom:1.5rem}
        .content-card ul{margin:1rem 0 1.5rem 2rem}
        .content-card li{color:var(--text-secondary);line-height:1.8;margin-bottom:0.75rem}
        .code-block{background:#1e293b;color:#e2e8f0;padding:1.5rem;border-radius:var(--radius-md);overflow-x:auto;margin:1.5rem 0;font-family:var(--font-mono);font-size:0.875rem;line-height:1.6}
        .alert-box{padding:1.5rem;border-radius:var(--radius-md);margin:1.5rem 0;display:flex;align-items:flex-start;gap:1rem}
        .alert-info{background:#dbeafe;border:1px solid #3b82f6}
        .alert-success{background:#dcfce7;border:1px solid #22c55e}
        .alert-icon{font-size:1.25rem;flex-shrink:0}
        .alert-info .alert-icon{color:#1e40af}
        .alert-success .alert-icon{color:#16a34a}
        .alert-content{flex-grow:1}
        .alert-info .alert-content{color:#1e3a8a}
        .alert-success .alert-content{color:#14532d}
        @media (max-width:768px){.hero h1{font-size:2rem}.content-card{padding:2rem 1.5rem}}
    </style>
</head>
<body>
    <div class="breadcrumb">
        <div class="breadcrumb-container">
            <a href="index.html"><i class="fas fa-home"></i> Documentation</a>
            <i class="fas fa-chevron-right"></i>
            <span>YP Directory</span>
        </div>
    </div>

    <div class="hero">
        <div class="hero-content">
            <h1><i class="fas fa-list"></i> YP Directory Listing</h1>
            <p>Increase stream discoverability through directory services</p>
        </div>
    </div>

    <div class="container">
        <div class="content-card">
            <h2><i class="fas fa-info-circle"></i> Overview</h2>
            <p>
                YP (Yellow Pages) directories are public listings where internet radio streams can be discovered by listeners.
                Mcaster1DNAS v2.5.1-rc1 can automatically register your streams with compatible directory services, making
                your broadcasts discoverable to a worldwide audience.
            </p>

            <div class="alert-box alert-success">
                <i class="fas fa-star alert-icon"></i>
                <div class="alert-content">
                    <strong>Enhanced YP Logging in v2.5.1-rc1:</strong> This release includes detailed YP directory logging
                    to help troubleshoot registration issues. All registration attempts, successes, and failures are logged
                    for analysis.
                </div>
            </div>

            <h2><i class="fas fa-check-circle"></i> Requirements</h2>
            <p>To use YP directory listing, ensure:</p>
            <ul>
                <li><strong>libcurl Support:</strong> Mcaster1DNAS must be compiled with libcurl (automatic if libcurl is installed)</li>
                <li><strong>Public Stream:</strong> Your stream must be publicly accessible (not behind NAT without port forwarding)</li>
                <li><strong>Required Metadata:</strong> Stream name, description, genre, and URL must be configured</li>
                <li><strong>Source Client Support:</strong> Source client must send <code>ice-public:1</code> header</li>
            </ul>

            <h2><i class="fas fa-cog"></i> Configuring YP in Mcaster1DNAS (YAML)</h2>

            <h3>Global YP Configuration</h3>
            <div class="code-block"><pre># Server-wide YP settings (mcaster1.yaml)
yp:
  directories:
    - url: http://dir.xiph.org/cgi-bin/yp-cgi
      timeout: 15
    - url: http://dir2.xiph.org/cgi-bin/yp-cgi
      timeout: 15</pre></div>

            <h3>Mountpoint YP Configuration</h3>
            <div class="code-block"><pre># Mountpoint with YP listing (mcaster1.yaml)
mount:
  - path: /stream
    stream_name: "My Amazing Radio Station"
    stream_description: "The best music 24/7"
    stream_url: https://example.com
    genre: Rock
    bitrate: 128
    public: true              # Enable YP listing
    max_listeners: 100</pre></div>

            <h3>Configuration Parameters</h3>
            <ul>
                <li><strong>public:</strong> Set to <code>true</code> to enable YP listing (default: false)</li>
                <li><strong>stream_name:</strong> Name of your station (required for YP)</li>
                <li><strong>stream_description:</strong> Description of your content (required for YP)</li>
                <li><strong>stream_url:</strong> Website URL (required for YP)</li>
                <li><strong>genre:</strong> Stream category/genre (required for YP)</li>
                <li><strong>bitrate:</strong> Stream bitrate in kbps (required for YP)</li>
            </ul>

            <div class="alert-box alert-info">
                <i class="fas fa-info-circle alert-icon"></i>
                <div class="alert-content">
                    <strong>Multiple Directories:</strong> You can configure multiple YP directory servers for redundancy.
                    Mcaster1DNAS will attempt registration with all configured directories.
                </div>
            </div>

            <h2><i class="fas fa-broadcast-tower"></i> Source Client Configuration</h2>
            <p>
                Your source client must be configured to enable YP listing. Most modern source clients support this:
            </p>

            <h3>Common Source Clients</h3>
            <ul>
                <li><strong>Butt:</strong> Enable "Make stream public" in settings</li>
                <li><strong>Liquidsoap:</strong> Set <code>public = true</code> in output configuration</li>
                <li><strong>SAM Broadcaster:</strong> Check "List in Directory" in encoder settings</li>
                <li><strong>FFmpeg:</strong> Add <code>-ice_public 1</code> to command line</li>
            </ul>

            <p>
                The source client sends the HTTP header <code>ice-public:1</code> when connecting to indicate
                the stream should be listed publicly.
            </p>

            <h2><i class="fas fa-chart-bar"></i> Monitoring YP Status</h2>
            <p>
                Check if your stream is successfully listed in YP directories:
            </p>

            <h3>Via Statistics XML</h3>
            <div class="code-block"><pre>http://yourserver:8000/admin/stats.xml</pre></div>
            <p>
                Look for YP-specific fields in the mountpoint section:
            </p>
            <ul>
                <li><strong>&lt;public&gt;1&lt;/public&gt;</strong> - Indicates YP listing is enabled</li>
                <li><strong>&lt;yp-currently-playing&gt;</strong> - Current song from YP perspective</li>
                <li><strong>&lt;yp-last-touch&gt;</strong> - Last successful YP update timestamp</li>
            </ul>

            <h3>YP Logging (v2.5.1-rc1)</h3>
            <p>
                Enhanced logging provides detailed information about YP operations:
            </p>
            <div class="code-block"><pre>tail -f /var/log/mcaster1/error.log | grep YP</pre></div>

            <p>
                Log entries include:
            </p>
            <ul>
                <li>Registration attempts and responses</li>
                <li>Update intervals and heartbeats</li>
                <li>Error messages with specific failure reasons</li>
                <li>Directory server response codes</li>
            </ul>

            <h2><i class="fas fa-search"></i> Finding Your Stream</h2>
            <p>
                Once successfully registered, listeners can find your stream through:
            </p>
            <ul>
                <li><strong>Directory Websites:</strong> Browse categories at YP directory sites</li>
                <li><strong>Search:</strong> Search by station name, genre, or description</li>
                <li><strong>Media Players:</strong> Many players include directory browsing (TuneIn, RadioDroid)</li>
                <li><strong>Aggregators:</strong> Third-party services that aggregate multiple directories</li>
            </ul>

            <h2><i class="fas fa-exclamation-triangle"></i> Troubleshooting YP Issues</h2>

            <h3>Stream Not Appearing in Directory</h3>
            <ul>
                <li>Check <code>public: true</code> is set in mountpoint configuration</li>
                <li>Verify all required metadata fields are populated</li>
                <li>Confirm source client is sending <code>ice-public:1</code> header</li>
                <li>Check YP logs in error.log for registration failures</li>
                <li>Ensure server is publicly accessible (test from external network)</li>
                <li>Verify libcurl is installed: <code>mcaster1 -v</code> should show curl support</li>
            </ul>

            <h3>Registration Fails</h3>
            <ul>
                <li>Check YP directory URL is correct and reachable</li>
                <li>Increase timeout value if network is slow</li>
                <li>Review error.log for specific error messages</li>
                <li>Test directory server manually with curl</li>
            </ul>

            <h3>Outdated Information in Directory</h3>
            <ul>
                <li>YP directories cache information and update periodically</li>
                <li>Updates typically propagate within 5-15 minutes</li>
                <li>Check YP logs to verify updates are being sent</li>
                <li>Metadata changes require source client reconnection</li>
            </ul>

            <h2><i class="fas fa-shield-alt"></i> Privacy Considerations</h2>
            <p>
                When listing in public directories, be aware:
            </p>
            <ul>
                <li><strong>Public Access:</strong> Anyone can discover and listen to your stream</li>
                <li><strong>Server Information:</strong> Your server IP and port are publicly visible</li>
                <li><strong>Metadata Exposure:</strong> All metadata (song titles, descriptions) is public</li>
                <li><strong>Listener Privacy:</strong> Consider privacy implications for listeners</li>
            </ul>

            <p>
                For private streams, set <code>public: false</code> and distribute stream URLs directly to authorized listeners.
            </p>

            <div style="background:var(--bg-accent);border-left:4px solid var(--dnas-green);padding:1.5rem;border-radius:var(--radius-lg);margin-top:2rem">
                <p style="margin:0;color:var(--text-primary)">
                    <strong><i class="fas fa-lightbulb"></i> Next Steps:</strong>
                    Learn about <a href="mcaster1dnas_listenerauth.html" style="color:var(--mcaster-blue);font-weight:600">Listener Authentication</a>
                    for private streams or explore <a href="mcaster1dnas_admin.html" style="color:var(--mcaster-blue);font-weight:600">Admin Interface</a>.
                </p>
            </div>
        </div>
    </div>
</body>
</html>
